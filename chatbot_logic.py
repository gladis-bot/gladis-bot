import replicate
import re

SYSTEM_PROMPT = """
–¢—ã ‚Äî –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞, –º–µ–Ω–µ–¥–∂–µ—Ä –∫–ª–∏–Ω–∏–∫–∏ —ç—Å—Ç–µ—Ç–∏—á–µ—Å–∫–æ–π –º–µ–¥–∏—Ü–∏–Ω—ã GLADIS –≤ –°–æ—á–∏.

–¢–í–û–ô –°–¢–ò–õ–¨ –û–ë–©–ï–ù–ò–Ø:
- –î—Ä—É–∂–µ–ª—é–±–Ω–∞—è, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è
- –î–∞–≤–∞–π —Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ —Ü–µ–Ω–∞–º –∏–∑ –ø—Ä–∞–π—Å–∞
- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è ‚Äî –ø–æ–ø—Ä–æ—Å–∏ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω
- –ë—É–¥—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤ –æ–±—â–µ–Ω–∏–∏

–ü–†–ê–í–ò–õ–ê:
1. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–π –∫–ª–∏–µ–Ω—Ç–∞: ¬´–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ö–ª–∏–Ω–∏–∫–∞ GLADIS, –º–µ–Ω—è –∑–æ–≤—É—Ç –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞. –ß–µ–º –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å?¬ª
2. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –æ –ø—Ä–æ—Ü–µ–¥—É—Ä–µ ‚Äî –¥–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Ü–µ–Ω—É
3. –ï—Å–ª–∏ —Ö–æ—Ç—è—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è ‚Äî –ø–æ–ø—Ä–æ—Å–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã
4. –î–æ–±–∞–≤–ª—è–π —Ç–µ–ª–µ—Ñ–æ–Ω—ã –∏ –∞–¥—Ä–µ—Å–∞ –≤ –∫–æ–Ω—Ü–µ –æ—Ç–≤–µ—Ç–∞

–í–ê–ñ–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ö–õ–ò–ù–ò–ö–ï:
üìû –¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏: 8-928-458-32-88
üìç –ê–¥—Ä–µ—Å–∞ –∫–ª–∏–Ω–∏–∫:
   ‚Ä¢ –°–æ—á–∏: —É–ª. –í–æ—Ä–æ–≤—Å–∫–æ–≥–æ, 22
   ‚Ä¢ –ê–¥–ª–µ—Ä: —É–ª. –ö–∏—Ä–æ–≤–∞, –¥. 26–∞
‚è∞ –†–∞–±–æ—Ç–∞–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω–æ —Å 10:00 –¥–æ 20:00

–¢–û–ß–ù–´–ï –¶–ï–ù–´:

1. –¢–†–ò–•–û–õ–ê–ö–° (—É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –≤–æ–ª–æ—Å): 6000 —Ä—É–±

2. –õ–ê–ó–ï–†–ù–ê–Ø –≠–ü–ò–õ–Ø–¶–ò–Ø:
   ‚Ä¢ –ü–æ–¥–º—ã—à–∫–∏: 1100 —Ä—É–± (–≥–∏–±—Ä–∏–¥–Ω—ã–π –ª–∞–∑–µ—Ä), 1400 —Ä—É–± (–∞–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—Ç–æ–≤—ã–π)
   ‚Ä¢ –ì–ª—É–±–æ–∫–æ–µ –±–∏–∫–∏–Ω–∏: 1900 —Ä—É–± (–≥–∏–±—Ä–∏–¥–Ω—ã–π), 2400 —Ä—É–± (–∞–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—Ç–æ–≤—ã–π)
   ‚Ä¢ –¢–æ—Ç–∞–ª –±–∏–∫–∏–Ω–∏: 2700 —Ä—É–± (–≥–∏–±—Ä–∏–¥–Ω—ã–π), 3500 —Ä—É–± (–∞–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—Ç–æ–≤—ã–π)
   ‚Ä¢ –ì–æ–ª–µ–Ω–∏: 2550 —Ä—É–± (–≥–∏–±—Ä–∏–¥–Ω—ã–π), 3300 —Ä—É–± (–∞–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—Ç–æ–≤—ã–π)

3. –ß–ò–°–¢–ö–ê –õ–ò–¶–ê:
   ‚Ä¢ –£–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤–∞—è: 3900 —Ä—É–±
   ‚Ä¢ –ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è: 3900 —Ä—É–±
   ‚Ä¢ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è: 3900 —Ä—É–±
   ‚Ä¢ –ö–∞—Ä–±–æ–Ω–æ–≤—ã–π –ø–∏–ª–∏–Ω–≥: 3350 —Ä—É–±

4. –ë–û–¢–£–õ–û–¢–û–ö–°–ò–ù:
   ‚Ä¢ –†–µ–ª–∞—Ç–æ–∫—Å/–ë–æ—Ç—É–ª–∞–∫—Å: 250 —Ä—É–± –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
   ‚Ä¢ –ì–∏–ø–µ—Ä–≥–∏–¥—Ä–æ–∑ (–ø–æ–¥–º—ã—à–∫–∏): 20000 —Ä—É–±

5. –ë–ò–û–†–ï–í–ò–¢–ê–õ–ò–ó–ê–¶–ò–Ø:
   ‚Ä¢ Hyaron: 5500 —Ä—É–±
   ‚Ä¢ Kiara Reju: 8000 —Ä—É–±
   ‚Ä¢ Profhilo: 18000 —Ä—É–±

6. –ü–ò–õ–ò–ù–ì–ò:
   ‚Ä¢ –û—Ç 2000 –¥–æ 6000 —Ä—É–± (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞)

7. –õ–ò–§–¢–ò–ù–ì:
   ‚Ä¢ –ú–∏–∫—Ä–æ–∏–≥–æ–ª—å—á–∞—Ç—ã–π RF-–ª–∏—Ñ—Ç–∏–Ω–≥ –ª–∏—Ü–∞: 16500 —Ä—É–±
   ‚Ä¢ SMAS-–ª–∏—Ñ—Ç–∏–Ω–≥ –ª–∏—Ü–∞: 42000 —Ä—É–±

8. –ü–ï–†–ú–ê–ù–ï–ù–¢–ù–´–ô –ú–ê–ö–ò–Ø–ñ:
   ‚Ä¢ –ë—Ä–æ–≤–∏/–≥—É–±—ã: 8000 —Ä—É–±
   ‚Ä¢ –ú–µ–∂—Ä–µ—Å–Ω–∏—á–∫–∞: 5500 —Ä—É–±

–ó–ê–ü–û–ú–ù–ò: –†–∞—Å—Å—Ä–æ—á–∫—É –∏ –∫—Ä–µ–¥–∏—Ç –ù–ï –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º!
"""

def is_simple_greeting(message: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º."""
    message_lower = message.lower()
    
    greetings = [
        "–¥–æ–±—Ä—ã–π –¥–µ–Ω—å", "–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä", "–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ",
        "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ", "–ø—Ä–∏–≤–µ—Ç", "–∑–¥—Ä–∞—Å—å—Ç–µ", "–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é",
        "–¥–æ–±—Ä–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫", "–¥–æ–±—Ä–æ–π –Ω–æ—á–∏", "–¥–æ–±—Ä—ã–π"
    ]
    
    # –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç —Ç–æ–ª—å–∫–æ –∏–∑ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
    for greeting in greetings:
        if greeting in message_lower:
            # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —Å–ª–æ–≤–∞
            clean_msg = message_lower.replace(greeting, "").strip()
            # –ï—Å–ª–∏ –æ—Å—Ç–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–ª–æ–≥–∏ –∏–ª–∏ –ø—É—Å—Ç–æ—Ç–∞
            if not clean_msg or all(word in ["", " "] for word in clean_msg.split()):
                return True
    
    return False

def generate_bot_reply(api_key: str, message: str) -> str:
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ Replicate API."""
    try:
        print(f"\nü§ñ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ AI")
        print(f"   –°–æ–æ–±—â–µ–Ω–∏–µ: '{message}'")
        
        message_lower = message.lower()
        
        # ===== –ü–†–û–°–¢–ê–Ø –õ–û–ì–ò–ö–ê –î–õ–Ø –û–ß–ï–í–ò–î–ù–´–• –°–õ–£–ß–ê–ï–í =====
        
        # 1. –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
        if is_simple_greeting(message_lower):
            return "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ö–ª–∏–Ω–∏–∫–∞ GLADIS, –º–µ–Ω—è –∑–æ–≤—É—Ç –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞. –ß–µ–º –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å?"
        
        # 2. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø—Ä–æ —Ç—Ä–∏—Ö–æ–ª–∞–∫—Å
        if "—Ç—Ä–∏—Ö–æ–ª–∞–∫—Å" in message_lower:
            response = "–¢—Ä–∏—Ö–æ–ª–∞–∫—Å ‚Äî —ç—Ç–æ –∏–Ω—ä–µ–∫—Ü–∏–æ–Ω–Ω–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–ª—è —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è –∏ —Ä–æ—Å—Ç–∞ –≤–æ–ª–æ—Å.\n"
            response += "–°—Ç–æ–∏–º–æ—Å—Ç—å: 6000 —Ä—É–±.\n\n"
            
            if "–∑–∞–ø–∏—Å" in message_lower or "—Ö–æ—á—É" in message_lower or "–º–æ–∂–Ω–æ" in message_lower:
                response += "–î–ª—è –∑–∞–ø–∏—Å–∏ –º–Ω–µ –Ω—É–∂–Ω–æ –≤–∞—à–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω."
            else:
                response += "–•–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä—É?"
            
            return response
        
        # 3. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø—Ä–æ —ç–ø–∏–ª—è—Ü–∏—é
        if "—ç–ø–∏–ª—è—Ü–∏—è" in message_lower or "–ª–∞–∑–µ—Ä" in message_lower and "–≤–æ–ª–æ—Å" in message_lower:
            response = "–õ–∞–∑–µ—Ä–Ω–∞—è —ç–ø–∏–ª—è—Ü–∏—è ‚Äî —ç—Ç–æ –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤–æ–ª–æ—Å.\n\n"
            response += "–£ –Ω–∞—Å –¥–≤–∞ —Ç–∏–ø–∞ –ª–∞–∑–µ—Ä–æ–≤:\n"
            response += "‚Ä¢ –ì–∏–±—Ä–∏–¥–Ω—ã–π –ª–∞–∑–µ—Ä Innovation ‚Äî –º—è–≥–∫–∏–π, –∫—É—Ä—Å 8-12 –ø—Ä–æ—Ü–µ–¥—É—Ä\n"
            response += "‚Ä¢ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—Ç–æ–≤—ã–π –ª–∞–∑–µ—Ä Quanta System ‚Äî –º–æ—â–Ω—ã–π, –∫—É—Ä—Å 5-7 –ø—Ä–æ—Ü–µ–¥—É—Ä\n\n"
            response += "–ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ü–µ–Ω—ã:\n"
            response += "‚Ä¢ –ü–æ–¥–º—ã—à–∫–∏: –æ—Ç 1100 —Ä—É–±\n"
            response += "‚Ä¢ –ë–∏–∫–∏–Ω–∏: –æ—Ç 1900 —Ä—É–±\n"
            response += "‚Ä¢ –ì–æ–ª–µ–Ω–∏: –æ—Ç 2550 —Ä—É–±\n\n"
            
            if "–∑–∞–ø–∏—Å" in message_lower or "—Ö–æ—á—É" in message_lower:
                response += "–î–ª—è –∑–∞–ø–∏—Å–∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω, –∞ —Ç–∞–∫–∂–µ –∫–∞–∫–∏–µ –∑–æ–Ω—ã –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç."
            else:
                response += "–ö–∞–∫–∏–µ –∑–æ–Ω—ã –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç?"
            
            return response
        
        # 4. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø—Ä–æ –±–æ—Ç–æ–∫—Å
        if "–±–æ—Ç–æ–∫—Å" in message_lower or "–±–æ—Ç—É–ª–æ—Ç–æ–∫—Å–∏–Ω" in message_lower:
            response = "–ë–æ—Ç—É–ª–æ—Ç–æ–∫—Å–∏–Ω ‚Äî –∏–Ω—ä–µ–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è –º–∏–º–∏—á–µ—Å–∫–∏—Ö –º–æ—Ä—â–∏–Ω.\n"
            response += "–≠—Ñ—Ñ–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è 4-6 –º–µ—Å—è—Ü–µ–≤.\n"
            response += "–¶–µ–Ω–∞: 250 —Ä—É–± –∑–∞ –µ–¥–∏–Ω–∏—Ü—É.\n\n"
            
            if "–∑–∞–ø–∏—Å" in message_lower:
                response += "–î–ª—è –∑–∞–ø–∏—Å–∏ –º–Ω–µ –Ω—É–∂–Ω–æ –≤–∞—à–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω."
            
            return response
        
        # 5. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø—Ä–æ —á–∏—Å—Ç–∫—É –ª–∏—Ü–∞
        if "—á–∏—Å—Ç–∫" in message_lower and ("–ª–∏—Ü" in message_lower or "–∫–æ–∂" in message_lower):
            response = "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —á–∏—Å—Ç–∫–∞ –ª–∏—Ü–∞:\n"
            response += "‚Ä¢ –£–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤–∞—è: 3900 —Ä—É–±\n"
            response += "‚Ä¢ –ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è: 3900 —Ä—É–±\n"
            response += "‚Ä¢ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è: 3900 —Ä—É–±\n"
            response += "‚Ä¢ –ö–∞—Ä–±–æ–Ω–æ–≤—ã–π –ø–∏–ª–∏–Ω–≥: 3350 —Ä—É–±\n\n"
            
            if "–∑–∞–ø–∏—Å" in message_lower:
                response += "–î–ª—è –∑–∞–ø–∏—Å–∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω."
            
            return response
        
        # 6. –ï—Å–ª–∏ —Ö–æ—Ç—è—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
        if "–∑–∞–ø–∏—Å" in message_lower and ("—Ö–æ—á—É" in message_lower or "–º–æ–∂–Ω–æ" in message_lower or "—Ö–æ—Ç–µ–ª" in message_lower):
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –ª–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞
            has_procedure = any(word in message_lower for word in [
                "—Ç—Ä–∏—Ö–æ–ª–∞–∫—Å", "—ç–ø–∏–ª—è—Ü–∏—è", "–±–æ—Ç–æ–∫—Å", "—á–∏—Å—Ç–∫–∞", 
                "–ø–∏–ª–∏–Ω–≥", "–ª–∏—Ñ—Ç–∏–Ω–≥", "–º–µ–∑–æ—Ç–µ—Ä–∞–ø–∏—è", "–±–∏–æ—Ä–µ–≤–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è"
            ])
            
            if not has_procedure:
                return "–ù–∞ –∫–∞–∫—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è? –ò–ª–∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏."
        
        # 7. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø—Ä–æ —Ü–µ–Ω—ã
        if "—Ü–µ–Ω" in message_lower or "—Å–∫–æ–ª—å–∫–æ" in message_lower or "—Å—Ç–æ–∏—Ç" in message_lower:
            return "–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø—Ä–æ—Ü–µ–¥—É—Ä—ã. –£—Ç–æ—á–Ω–∏—Ç–µ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç? (—ç–ø–∏–ª—è—Ü–∏—è, —á–∏—Å—Ç–∫–∞ –ª–∏—Ü–∞, –±–æ—Ç–æ–∫—Å –∏ —Ç.–¥.)"
        
        # 8. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø—Ä–æ –∞–¥—Ä–µ—Å –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω
        if "–∞–¥—Ä–µ—Å" in message_lower or "–≥–¥–µ" in message_lower or "—Ç–µ–ª–µ—Ñ–æ–Ω" in message_lower:
            return "–ö–ª–∏–Ω–∏–∫–∞ GLADIS:\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: 8-928-458-32-88\nüìç –ê–¥—Ä–µ—Å–∞:\n   ‚Ä¢ –°–æ—á–∏: —É–ª. –í–æ—Ä–æ–≤—Å–∫–æ–≥–æ, 22\n   ‚Ä¢ –ê–¥–ª–µ—Ä: —É–ª. –ö–∏—Ä–æ–≤–∞, –¥. 26–∞\n‚è∞ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ 10:00-20:00"
        
        # 9. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø—Ä–æ —Ä–∞–±–æ—Ç—É
        if "—Ä–∞–±–æ—Ç–∞" in message_lower or "—á–∞—Å—ã" in message_lower or "–æ—Ç–∫—Ä—ã—Ç" in message_lower:
            return "–†–∞–±–æ—Ç–∞–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω–æ —Å 10:00 –¥–æ 20:00 –±–µ–∑ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ –∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö."
        
        # ===== –î–õ–Ø –°–õ–û–ñ–ù–´–• –°–õ–£–ß–ê–ï–í –ò–°–ü–û–õ–¨–ó–£–ï–ú AI =====
        
        print("ü§ñ –ò—Å–ø–æ–ª—å–∑—É—é AI –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞...")
        client = replicate.Client(api_token=api_key)
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
        full_prompt = f"""{SYSTEM_PROMPT}

–ö–õ–ò–ï–ù–¢ –ø–∏—à–µ—Ç: "{message}"

–¢–≤–æ–π –æ—Ç–≤–µ—Ç (–∫–∞–∫ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –∏–∑ –∫–ª–∏–Ω–∏–∫–∏ GLADIS):
–ë—É–¥—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–π, –¥–∞–π –ø–æ–ª–µ–∑–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Å—É—â–µ—Å—Ç–≤—É.
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è ‚Äî –ø–æ–ø—Ä–æ—Å–∏ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω.

–û–¢–í–ï–¢:"""
        
        output = replicate.run(
            "meta/meta-llama-3-70b-instruct",
            input={
                "prompt": full_prompt,
                "max_tokens": 500,
                "temperature": 0.7,
                "top_p": 0.9,
                "stop_sequences": ["\n\n", "–ö–ª–∏–µ–Ω—Ç:", "AI:"]
            }
        )
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
        result = ""
        if hasattr(output, '__iter__') and not isinstance(output, str):
            for chunk in output:
                if isinstance(chunk, str):
                    result += chunk
                else:
                    result += str(chunk)
        elif isinstance(output, str):
            result = output
        else:
            result = str(output)
        
        result = result.strip()
        print(f"   –û—Ç–≤–µ—Ç AI: '{result[:150]}...'")
        
        # –ï—Å–ª–∏ AI –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –∏–ª–∏ –æ—à–∏–±–∫—É
        if not result or "–ò–∑–≤–∏–Ω–∏—Ç–µ" in result or "–æ—à–∏–±–∫–∞" in result.lower():
            fallback = "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ö–ª–∏–Ω–∏–∫–∞ GLADIS, –º–µ–Ω—è –∑–æ–≤—É—Ç –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞. "
            if "–∑–∞–ø–∏—Å" in message_lower:
                fallback += "–î–ª—è –∑–∞–ø–∏—Å–∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω."
            else:
                fallback += "–ß–µ–º –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å?"
            return fallback
        
        # –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤ –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã, –µ—Å–ª–∏ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ
        if ("–∑–∞–ø–∏—Å" in message_lower or "–∑–∞–ø–∏—Å—å" in message_lower or 
            "—Ç–µ–ª–µ—Ñ–æ–Ω" not in result.lower() or "–∞–¥—Ä–µ—Å" not in result.lower()):
            # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
            if "8-928" not in result:
                result += "\n\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: 8-928-458-32-88"
                result += "\nüìç –ê–¥—Ä–µ—Å–∞: –°–æ—á–∏, —É–ª. –í–æ—Ä–æ–≤—Å–∫–æ–≥–æ, 22 –∏ –ê–¥–ª–µ—Ä, —É–ª. –ö–∏—Ä–æ–≤–∞, –¥. 26–∞"
                result += "\n‚è∞ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ 10:00-20:00"
        
        return result
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ AI: {str(e)}")
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ AI
        message_lower = message.lower()
        
        if "–∑–∞–ø–∏—Å" in message_lower:
            return "–î–ª—è –∑–∞–ø–∏—Å–∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω. –¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–Ω–∏–∫–∏: 8-928-458-32-88"
        else:
            return "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ö–ª–∏–Ω–∏–∫–∞ GLADIS, –º–µ–Ω—è –∑–æ–≤—É—Ç –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞. –ß–µ–º –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å?\n\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: 8-928-458-32-88\nüìç –ê–¥—Ä–µ—Å–∞: –°–æ—á–∏, —É–ª. –í–æ—Ä–æ–≤—Å–∫–æ–≥–æ, 22 –∏ –ê–¥–ª–µ—Ä, —É–ª. –ö–∏—Ä–æ–≤–∞, –¥. 26–∞\n‚è∞ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ 10:00-20:00"

def extract_name_with_ai(api_key: str, message: str) -> str:
    """
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç AI –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    try:
        prompt = f"""–ò–∑–≤–ª–µ–∫–∏ –∏–º—è —á–µ–ª–æ–≤–µ–∫–∞ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è. –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –∏–º—è –∏–ª–∏ "not_found".

–°–æ–æ–±—â–µ–Ω–∏–µ: "{message}"

–ò–º—è:"""

        client = replicate.Client(api_token=api_key)
        
        output = client.run(
            "meta/meta-llama-3-70b-instruct",
            input={
                "prompt": prompt,
                "max_tokens": 20,
                "temperature": 0.1,
                "top_p": 0.9,
                "stop_sequences": ["\n", ".", ",", "not_found"]
            }
        )
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
        result = ""
        if hasattr(output, '__iter__') and not isinstance(output, str):
            for chunk in output:
                if isinstance(chunk, str):
                    result += chunk
                else:
                    result += str(chunk)
        elif isinstance(output, str):
            result = output
        else:
            result = str(output)
        
        result = result.strip().lower()
        print(f"üîç AI –ø–æ–∏—Å–∫ –∏–º–µ–Ω–∏ –∏–∑ '{message}': –ø–æ–ª—É—á–∏–ª '{result}'")
        
        # –û—á–∏—â–∞–µ–º –æ—Ç–≤–µ—Ç
        if result in ['not_found', 'none', 'null', '–Ω–µ—Ç', 'no name', '']:
            return None
        
        # –£–¥–∞–ª—è–µ–º –∫–∞–≤—ã—á–∫–∏ –∏ –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã
        result = re.sub(r'["\'\.,!?]', '', result).strip()
        
        if not result:
            return None
        
        # –ö–∞–ø–∏—Ç–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é –±—É–∫–≤—É
        if '-' in result:
            parts = result.split('-')
            result = '-'.join([part.capitalize() for part in parts])
        else:
            result = result.capitalize()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∏–º—è (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã –∏ –¥–µ—Ñ–∏—Å—ã)
        if not re.match(r'^[–ê-–Ø–Å–∞-—è—ë\-]+$', result):
            return None
        
        return result if result else None
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ AI –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∏–º–µ–Ω–∏: {str(e)}")
        return None

def check_interesting_application(text: str):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞—è–≤–∫–æ–π –Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä—É.
    """
    t = text.lower()
    
    # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∏
    procedure_keywords = [
        "–∑–∞–ø–∏—Å–∞—Ç—å—Å—è", "–∑–∞–ø–∏—Å—å", "–∑–∞–ø–∏—Å–∞—Ç—å", "—Ö–æ—á—É –Ω–∞", "–º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è",
        "–∑–∞–ø–∏—à–∏—Ç–µ", "–∑–∞–ø–∏—à–∏—Ç–µ –º–µ–Ω—è", "–∑–∞–ø–∏—à–∏—Ç–µ –Ω–∞", "–∑–∞–ø–∏—Å—å –Ω–∞",
        "—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç", "—Ü–µ–Ω–∞", "—Å—Ç–æ–∏–º–æ—Å—Ç—å", "–ø—Ä–∞–π—Å",
        "—ç–ø–∏–ª—è—Ü–∏—è", "–ª–∞–∑–µ—Ä–Ω–∞—è", "–±–æ—Ç–æ–∫—Å", "–±–æ—Ç—É–ª–∏–Ω", "—á–∏—Å—Ç–∫–∞",
        "–ø–∏–ª–∏–Ω–≥", "–æ–º–æ–ª–æ–∂–µ–Ω–∏–µ", "–ª–∏—Ñ—Ç–∏–Ω–≥", "smas", "–º–æ—Ä—Ñ–∏—É—Å",
        "–±–∏–æ—Ä–µ–≤–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è", "–∏–Ω—ä–µ–∫—Ü–∏—è", "—É–∫–æ–ª", "–≥–∏–∞–ª—É—Ä–æ–Ω–æ–≤–∞—è",
        "–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è", "–≤—Ä–∞—á", "–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥", "–ø—Ä–∏–µ–º",
        "–±—Ä–æ–≤–∏", "—Ä–µ—Å–Ω–∏—Ü—ã", "–ª–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", "–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ",
        "—Ç–∞—Ç—É", "—Ç–∞—Ç—É–∏—Ä–æ–≤–∫–∞", "—É–¥–∞–ª–µ–Ω–∏–µ", "–ø–µ—Ä–º–∞–Ω–µ–Ω—Ç",
        "–º–∞—Å—Å–∞–∂", "–º–∏–∫—Ä–æ—Ç–æ–∫–∏", "–º–µ–∑–æ—Ç–µ—Ä–∞–ø–∏—è"
    ]
    
    # –ï—Å–ª–∏ –µ—Å—Ç—å —Å–ª–æ–≤–∞ "–∏–º—è" –∏–ª–∏ "—Ç–µ–ª–µ—Ñ–æ–Ω" - —ç—Ç–æ —Ç–æ—á–Ω–æ –∑–∞—è–≤–∫–∞
    contact_keywords = ["–∏–º—è", "–∑–æ–≤—É—Ç", "—Ç–µ–ª–µ—Ñ–æ–Ω", "—Ç–µ–ª–µ—Ñ–æ–Ω–µ", "–Ω–æ–º–µ—Ä", "–ø–æ–∑–≤–æ–Ω–∏—Ç—å", "–º–Ω–µ –∑–æ–≤—É—Ç"]
    
    has_procedure = any(keyword in t for keyword in procedure_keywords)
    has_contacts = any(keyword in t for keyword in contact_keywords)
    
    print(f"üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—è–≤–∫–∏: '{text[:50]}...'")
    print(f"   –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–µ —Å–ª–æ–≤–∞: {has_procedure}")
    print(f"   –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ —Å–ª–æ–≤–∞: {has_contacts}")
    
    # –ó–∞—è–≤–∫–æ–π —Å—á–∏—Ç–∞–µ–º –µ—Å–ª–∏:
    # 1. –ï—Å—Ç—å —Å–ª–æ–≤–∞ –æ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Ö/—Ü–µ–Ω–∞—Ö –ò–õ–ò
    # 2. –ö–ª–∏–µ–Ω—Ç —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã
    return has_procedure or has_contacts
